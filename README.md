# Web Crawler API - Desafio Java Axur

**Desenvolvedor:** Christian Vladimir Uhdre Mulato  
**Posi√ß√£o:** Desenvolvedor Java S√™nior  
**Empresa:** Axur  

## Descri√ß√£o

Aplica√ß√£o Java Spring Boot desenvolvida como parte do teste t√©cnico para a posi√ß√£o de Backend Software Developer na Axur. A aplica√ß√£o realiza web crawling e busca de termos espec√≠ficos em websites, oferecendo uma API REST para intera√ß√£o e processamento ass√≠ncrono.

## Sobre o Desafio

Este projeto implementa a solu√ß√£o para o teste t√©cnico da Axur, atendendo aos seguintes requisitos:

- **API HTTP** na porta 4567 com endpoints para iniciar busca e consultar resultados
- **Web Crawling** de websites com busca de termos espec√≠ficos  
- **Processamento ass√≠ncrono** utilizando RabbitMQ
- **Persist√™ncia** em banco H2 com migra√ß√µes Flyway
- **Containeriza√ß√£o** com Docker e Docker Compose
- **Cobertura de testes** completa para todos os 8 requisitos (100%)
- **Configura√ß√£o UTF-8** completa para suporte internacional

## ‚≠ê Destaque: Testes Automatizados Completos

Este projeto possui **cobertura de testes automatizados para 100% dos requisitos** do desafio t√©cnico:

### üéØ Cobertura por Requisito

| Requisito | Status | Arquivo de Teste |
|-----------|--------|------------------|
| 1. API HTTP | ‚úÖ | `ApiHttpTest.java` |
| 2. Valida√ß√£o do termo | ‚úÖ | `TermValidationTest.java` |
| 3. ID da busca | ‚úÖ | `CrawlIdGenerationTest.java` |
| 4. URL base | ‚úÖ | `BaseUrlConfigurationTest.java` |
| 5. M√∫ltiplas buscas | ‚úÖ | `MultipleCrawlsTest.java` |
| 6. Resultados parciais | ‚úÖ | `PartialResultsTest.java` |
| 7. Estrutura do projeto | ‚úÖ | `ProjectStructureTest.java` |
| 8. Compila√ß√£o e execu√ß√£o | ‚úÖ | `CompilationExecutionTest.java` |

### üìä Estat√≠sticas de Testes

- **10 arquivos de teste** criados
- **50+ m√©todos de teste** implementados  
- **8/8 requisitos cobertos** (100%)
- **Cen√°rios**: Positivos, negativos, edge cases, concorr√™ncia, performance
- **Tipos**: Unit√°rios, integra√ß√£o, E2E com massa de dados realista

**üìñ Documenta√ß√£o detalhada:** [TESTES-COBERTURA-COMPLETA.md](docs/TESTES-COBERTURA-COMPLETA.md)

## Funcionalidades

### Web Crawling

- Busca case-insensitive em todo o conte√∫do HTML
- Segue links relativos e absolutos na mesma base URL
- Controle de URLs visitadas para evitar loops
- Timeout configur√°vel para requisi√ß√µes
- Delay entre requisi√ß√µes para evitar sobrecarga

### Processamento Ass√≠ncrono

- Utiliza RabbitMQ para processamento em background
- Suporte a m√∫ltiplas buscas simult√¢neas
- Resultados parciais dispon√≠veis durante o processamento

### Persist√™ncia

- Armazenamento das tarefas de crawling no banco H2
- Hist√≥rico de URLs visitadas e encontradas
- Estat√≠sticas detalhadas de cada busca
- Consulta de resultados em tempo real

### Monitoramento

#### Actuator Endpoints

- `/actuator/health`: Status da aplica√ß√£o
- `/actuator/info`: Informa√ß√µes da aplica√ß√£o
- `/actuator/metrics`: M√©tricas da aplica√ß√£o

#### Console H2

Durante o desenvolvimento, voc√™ pode acessar o console H2 em `http://localhost:4567/h2-console` para visualizar os dados:

- **JDBC URL**: `jdbc:h2:mem:testdb`
- **User Name**: `sa`
- **Password**: (deixe vazio)

## Tecnologias Utilizadas

- **Java 17** com features modernas
- **Spring Boot 3.4.1** com configura√ß√£o avan√ßada
- **Spring Data JPA** (para persist√™ncia)
- **H2 Database** (banco de dados em mem√≥ria)
- **Flyway** (migra√ß√£o de banco de dados)
- **RabbitMQ** (para processamento ass√≠ncrono)
- **JSoup** (para parsing HTML)
- **SpringDoc OpenAPI** (documenta√ß√£o da API)
- **JaCoCo** (para cobertura de c√≥digo)
- **JUnit 5** (para testes automatizados)
- **Docker** (para containeriza√ß√£o)

## Atendimento aos Requisitos do Desafio

### API HTTP (Porta 4567)

- **POST /crawl**: Inicia nova busca com keyword
- **GET /crawl/{id}**: Consulta resultados de busca
- **GET /crawl/{id}/stats**: Estat√≠sticas detalhadas da busca

### ‚úÖ Processamento Ass√≠ncrono

- Utiliza **RabbitMQ** para processamento em background
- Suporte a m√∫ltiplas buscas simult√¢neas
- Resultados dispon√≠veis durante o processamento

### Containeriza√ß√£o

- **Dockerfile** para build da aplica√ß√£o
- **docker-compose.yml** com RabbitMQ integrado
- Configura√ß√µes UTF-8 completas

### Qualidade de C√≥digo

- **Cobertura de testes**: 100% dos requisitos do desafio + 80% m√≠nimo (JaCoCo)
- **Testes automatizados**: JUnit 5 + Mockito + integra√ß√£o E2E
- **Valida√ß√µes**: Spring Validation para entrada
- **Logs estruturados**: Logback com rota√ß√£o

### Funcionalidades Extras Implementadas

- **Persist√™ncia**: H2 + Flyway para migra√ß√µes
- **Monitoramento**: Spring Actuator endpoints
- **Massa de dados**: Dados de exemplo para demonstra√ß√£o
- **Documenta√ß√£o**: README + docs t√©cnicas

## Requisitos

- Docker
- Docker Compose (opcional, para desenvolvimento local)

## Configura√ß√£o

### Vari√°veis de Ambiente

- `BASE_URL`: URL base do website a ser analisado (padr√£o: `http://localhost:8080`)

### Banco de Dados

A aplica√ß√£o utiliza H2 como banco de dados em mem√≥ria com as seguintes configura√ß√µes:

- **URL**: `jdbc:h2:mem:testdb`
- **Console H2**: Dispon√≠vel em `http://localhost:4567/h2-console`
- **Usu√°rio**: `sa`
- **Senha**: (vazia)

### Flyway

As migra√ß√µes do banco de dados s√£o gerenciadas pelo Flyway e est√£o localizadas em `src/main/resources/db/migration/`.

### Propriedades da Aplica√ß√£o

As configura√ß√µes podem ser ajustadas no arquivo `application.yml`:

```yaml
app:
  base-url: ${BASE_URL:http://localhost:8080}
  crawler:
    max-pages: 1000
    timeout: 30000
    user-agent: "Web Crawler 1.0"
    delay: 100
  search:
    min-keyword-length: 4
    max-keyword-length: 32
    id-length: 8
    max-results: 100
```

## Execu√ß√£o

### Docker Compose (Recomendado)

```bash
# 1. Criar arquivo de configura√ß√£o
cp .env.example .env

# 2. Ajustar URL base se necess√°rio (opcional)
# Edite o arquivo .env: BASE_URL=http://hiring.axreng.com/

# 3. Iniciar todos os servi√ßos
docker-compose up -d

# 4. Verificar logs
docker-compose logs -f

# 5. Parar os servi√ßos
docker-compose down
```

**URLs ap√≥s inicializa√ß√£o:**

- **Aplica√ß√£o**: <http://localhost:4567>
- **Swagger UI**: <http://localhost:4567/swagger-ui.html>
- **OpenAPI Docs**: <http://localhost:4567/api-docs>
- **RabbitMQ Management**: <http://localhost:15672> (guest/guest)
- **Health Check**: <http://localhost:4567/actuator/health>
- **H2 Console**: <http://localhost:4567/h2-console> (sa/vazio)

### Setup Automatizado (Scripts)

Para facilitar a inicializa√ß√£o, voc√™ pode usar os scripts de automa√ß√£o:

**Linux/macOS:**

```bash
# Configurar e iniciar ambiente completo automaticamente
chmod +x setup-dev.sh
./setup-dev.sh
```

**Windows (PowerShell):**

```powershell
# Configurar e iniciar ambiente completo automaticamente
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
.\setup-dev.ps1
```

Os scripts automaticamente:

1. Verificam se Docker est√° rodando
2. Criam arquivo `.env` se n√£o existir
3. Fazem build da aplica√ß√£o
4. Iniciam todos os servi√ßos via Docker Compose
5. Verificam se os servi√ßos est√£o saud√°veis
6. Exibem URLs de acesso e informa√ß√µes √∫teis

### Desenvolvimento Local (sem Docker)

```bash
# 1. Iniciar apenas RabbitMQ
docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management

# 2. Executar aplica√ß√£o localmente
mvn spring-boot:run
```

### Produ√ß√£o (Docker standalone)

```bash
# Build da aplica√ß√£o
docker build . -t axreng/backend

# Execu√ß√£o
docker run -e BASE_URL=http://hiring.axreng.com/ -p 4567:4567 --rm axreng/backend
```

## API

A API est√° totalmente documentada com **OpenAPI 3.0** (Swagger). Ap√≥s iniciar a aplica√ß√£o, voc√™ pode:

- **Explorar a API**: Acesse <http://localhost:4567/swagger-ui.html>
- **Ver especifica√ß√£o OpenAPI**: Acesse <http://localhost:4567/api-docs>
- **Testar endpoints**: Use a interface interativa do Swagger UI

### Endpoints Dispon√≠veis

### Iniciar Busca

**POST** `/crawl`

```json
{
  "keyword": "security"
}
```

**Resposta:**

```json
{
  "id": "30vbllyb"
}
```

### Consultar Resultados

**GET** `/crawl/{id}`

**Resposta:**

```json
{
  "id": "30vbllyb",
  "status": "active",
  "urls": [
    "http://hiring.axreng.com/index2.html",
    "http://hiring.axreng.com/htmlman1/chcon.1.html"
  ]
}
```

### Consultar Estat√≠sticas

**GET** `/crawl/{id}/stats`

**Resposta:**

```json
{
  "id": "30vbllyb",
  "keyword": "security",
  "status": "active",
  "total_urls_found": 15,
  "total_pages_processed": 50,
  "start_time": "2025-07-09T12:00:00",
  "end_time": null
}
```

### Status da Busca

- `active`: Busca em andamento
- `done`: Busca conclu√≠da

## Testes

### Executar Testes

```bash
# Executar todos os testes
mvn test

# Executar testes com cobertura
mvn clean test jacoco:report

# Verificar cobertura m√≠nima
mvn clean test jacoco:check
```

### Relat√≥rio de Cobertura

O relat√≥rio de cobertura JaCoCo ser√° gerado em `target/site/jacoco/index.html`

## Monitoramento e Logs

### Endpoints de Monitoramento

- `/actuator/health`: Status da aplica√ß√£o
- `/actuator/info`: Informa√ß√µes da aplica√ß√£o
- `/actuator/metrics`: M√©tricas da aplica√ß√£o

### Logs

A aplica√ß√£o gera logs detalhados para debugging e monitoramento em diferentes arquivos:

**Arquivos de Log:**

- `logs/application.log`: Logs gerais da aplica√ß√£o
- `logs/crawl.log`: Logs espec√≠ficos de crawling
- `logs/test-execution.log`: Logs dos testes unit√°rios

**Configura√ß√£o de Log:**

- Rota√ß√£o autom√°tica por tamanho (10MB para aplica√ß√£o, 5MB para testes)
- Reten√ß√£o de 30 dias para aplica√ß√£o, 5 dias para testes
- Diferentes n√≠veis de log para diferentes componentes

**Exemplo de logs:**

```text
2025-07-09 10:30:00 [main] INFO  com.mulato.axur.service.CrawlService - Starting crawl for task: abc12345
2025-07-09 10:30:01 [crawler-1] DEBUG com.mulato.axur.service.WebCrawlerService - Found keyword 'security' in URL: http://example.com/page1
2025-07-09 10:30:05 [crawler-1] INFO  com.mulato.axur.service.WebCrawlerService - Crawl completed for task: abc12345 - Pages processed: 50, URLs found: 5
```

## Arquitetura

### Componentes Principais

1. **CrawlController**: API REST endpoints
2. **CrawlService**: Gerenciamento de tarefas de crawling
3. **WebCrawlerService**: L√≥gica de web crawling
4. **CrawlTaskPersistenceService**: Persist√™ncia de dados
5. **CrawlMessageService**: Envio de mensagens para RabbitMQ
6. **CrawlTaskListener**: Processamento de mensagens do RabbitMQ

### Estrutura do Banco de Dados

**Tabelas:**

- `crawl_tasks`: Armazena informa√ß√µes das tarefas de crawling
- `crawl_urls`: Armazena URLs encontradas durante o crawling
- `visited_urls`: Controla URLs j√° visitadas para evitar loops

### Fluxo de Execu√ß√£o

1. Cliente envia POST `/crawl` com keyword
2. Sistema gera ID √∫nico e cria tarefa
3. Tarefa √© enviada para fila RabbitMQ
4. Worker processa tarefa em background
5. Cliente consulta resultados via GET `/crawl/{id}`

## Limita√ß√µes

- M√°ximo de 1000 p√°ginas por busca
- Timeout de 30 segundos por requisi√ß√£o
- Delay de 100ms entre requisi√ß√µes
- Cobertura de c√≥digo m√≠nima de 80%

## Desenvolvimento

### Configura√ß√£o do Ambiente

1. **Clone o reposit√≥rio**
2. **Configure o RabbitMQ** (se executando localmente)
3. **Execute as migra√ß√µes** (autom√°tico com Flyway)
4. **Inicie a aplica√ß√£o**

### Migra√ß√µes do Banco de Dados

As migra√ß√µes s√£o executadas automaticamente pelo Flyway na inicializa√ß√£o. Para criar novas migra√ß√µes:

1. Crie um arquivo em `src/main/resources/db/migration/`
2. Nomeie seguindo o padr√£o: `V{version}__{description}.sql`
3. Exemplo: `V5__Add_new_column.sql`

### Estrutura do Projeto

```text
axreng-test/
‚îú‚îÄ‚îÄ README.md                           # Documenta√ß√£o principal do projeto
‚îú‚îÄ‚îÄ docker-compose.yml                  # Orquestra√ß√£o Docker principal (App + RabbitMQ)
desenvolvimento
‚îú‚îÄ‚îÄ Dockerfile                          # Build da aplica√ß√£o Java
‚îú‚îÄ‚îÄ pom.xml                             # Depend√™ncias e configura√ß√£o Maven
‚îú‚îÄ‚îÄ manage-data.sh                      # Script para gerenciar massa de dados
‚îú‚îÄ‚îÄ setup-dev.sh                        # Script de setup para Linux/macOS
‚îú‚îÄ‚îÄ setup-dev.ps1                       # Script de setup para Windows (PowerShell)
‚îÇ
‚îú‚îÄ‚îÄ docs/                               # Documenta√ß√µes t√©cnicas
‚îÇ   ‚îú‚îÄ‚îÄ INDEX.md                        # √çndice das documenta√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ DESAFIO_JAVA_AXUR.md            # Requisitos originais do teste t√©cnico
‚îÇ   ‚îú‚îÄ‚îÄ DESAFIO_JAVA_AXUR.pdf           # Documento original (PDF)
‚îÇ   ‚îú‚îÄ‚îÄ DATABASE.md                     # Estrutura do banco e massa de dados
‚îÇ   ‚îú‚îÄ‚îÄ DOCKER-COMPOSE.md               # Guia do Docker Compose
‚îÇ   ‚îî‚îÄ‚îÄ UTF8-CONFIG.md                  # Configura√ß√µes UTF-8 implementadas
‚îÇ
‚îú‚îÄ‚îÄ logs/                               # Arquivos de log da aplica√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ README.md                       # Documenta√ß√£o sobre logs
‚îÇ
‚îú‚îÄ‚îÄ src/                                # C√≥digo fonte
‚îÇ   ‚îú‚îÄ‚îÄ main/                           # C√≥digo principal da aplica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com/mulato/axur/        # Pacote principal
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Main.java           # Classe principal Spring Boot
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ config/             # Configura√ß√µes Spring
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ RabbitConfig.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ controller/         # Controllers REST
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ CrawlController.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ entity/             # Entidades JPA
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlTaskEntity.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlResultEntity.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ VisitedUrlEntity.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ exception/          # Tratamento de exce√ß√µes
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ GlobalExceptionHandler.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ listener/           # Listeners RabbitMQ
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ CrawlTaskListener.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ model/              # DTOs e modelos
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlRequest.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlResponse.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlResult.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ CrawlTask.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ repository/         # Reposit√≥rios JPA
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlTaskRepository.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlResultRepository.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ VisitedUrlRepository.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ service/            # L√≥gica de neg√≥cio
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ CrawlService.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ CrawlMessageService.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ CrawlPersistenceService.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ IdGeneratorService.java
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ WebCrawlerService.java
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/                  # Recursos da aplica√ß√£o
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.yml         # Configura√ß√£o principal
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application-docker.yml  # Configura√ß√£o para Docker
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ logback-spring.xml      # Configura√ß√£o de logs
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ db/                     # Banco de dados
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ migration/          # Migra√ß√µes Flyway
‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ V1__Create_crawl_tables.sql
‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ V2__Insert_test_data.sql
‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ V3__Insert_realistic_test_data.sql
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ sample-data.sql     # Dados adicionais para desenvolvimento
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ test/                           # Testes unit√°rios
‚îÇ       ‚îú‚îÄ‚îÄ java/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ com/mulato/axur/        # Mesma estrutura do c√≥digo principal
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ controller/         # Testes dos controllers
‚îÇ       ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ CrawlControllerTest.java
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ entity/             # Testes das entidades
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlTaskEntityTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlResultEntityTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ VisitedUrlEntityTest.java
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ exception/          # Testes de tratamento de exce√ß√µes
‚îÇ       ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ GlobalExceptionHandlerTest.java
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ listener/           # Testes dos listeners
‚îÇ       ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ CrawlTaskListenerTest.java
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ model/              # Testes dos modelos
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlRequestTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlResponseTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlResultTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ CrawlTaskTest.java
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ repository/         # Testes dos reposit√≥rios
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlResultRepositoryTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ VisitedUrlRepositoryTest.java
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ service/            # Testes dos servi√ßos
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlServiceTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlServiceLogTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlMessageServiceTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CrawlPersistenceServiceTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ IdGeneratorServiceTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ WebCrawlerServiceTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ LoggingConfigurationTest.java
‚îÇ       ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ LoggingIntegrationTest.java
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ util/               # Utilit√°rios de teste
‚îÇ       ‚îÇ           ‚îî‚îÄ‚îÄ LogCapture.java
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ resources/                  # Recursos para testes
‚îÇ           ‚îú‚îÄ‚îÄ application.yml         # Configura√ß√£o para testes
‚îÇ           ‚îî‚îÄ‚îÄ logback-test.xml        # Configura√ß√£o de logs para testes
‚îÇ
‚îî‚îÄ‚îÄ target/                             # Arquivos gerados (Maven)
    ‚îú‚îÄ‚îÄ classes/                        # Classes compiladas
    ‚îú‚îÄ‚îÄ test-classes/                   # Classes de teste compiladas
    ‚îú‚îÄ‚îÄ site/jacoco/                    # Relat√≥rios de cobertura JaCoCo
    ‚îî‚îÄ‚îÄ surefire-reports/               # Relat√≥rios de testes
```

### Detalhes da Estrutura

#### Principais Diret√≥rios

- **`src/main/java/`**: C√≥digo fonte da aplica√ß√£o
- **`src/test/java/`**: Testes unit√°rios e de integra√ß√£o
- **`src/main/resources/`**: Configura√ß√µes e recursos
- **`docs/`**: Documenta√ß√£o t√©cnica completa
- **`logs/`**: Arquivos de log da aplica√ß√£o

#### Scripts de Automa√ß√£o

- **`setup-dev.sh`**: Script para inicializar ambiente no Linux/macOS
- **`setup-dev.ps1`**: Script para inicializar ambiente no Windows (PowerShell)
- **`manage-data.sh`**: Script para gerenciar massa de dados do H2
- **`docker-compose.yml`**: Orquestra√ß√£o completa (App + RabbitMQ)
- **`docker-compose.dev.yml`**: Apenas RabbitMQ para desenvolvimento local

#### Arquitetura em Camadas

1. **Controller Layer** (`controller/`): Endpoints REST
2. **Service Layer** (`service/`): L√≥gica de neg√≥cio
3. **Repository Layer** (`repository/`): Acesso a dados
4. **Entity Layer** (`entity/`): Mapeamento JPA
5. **Model Layer** (`model/`): DTOs e transfer√™ncia de dados

#### Configura√ß√µes

- **Maven**: `pom.xml` + `.mvn/maven.config` (UTF-8)
- **Spring Boot**: `application.yml` + `application-docker.yml`
- **Docker**: `Dockerfile` + `docker-compose.yml` + `docker-compose.dev.yml`
- **Logs**: `logback-spring.xml` + `logback-test.xml`
- **Banco**: Migra√ß√µes Flyway em `db/migration/`
- **Ambiente**: `.env` + `.env.example`

#### Qualidade e Testes

- **Cobertura**: JaCoCo reports em `target/site/jacoco/`
- **Testes**: Estrutura espelhada em `src/test/`
- **Utilit√°rios**: `LogCapture` para valida√ß√£o de logs
- **Dados**: Massa de dados em `db/migration/` e `sample-data.sql`

### Conven√ß√µes de C√≥digo

- Usar Java 17 features
- Seguir padr√µes Spring Boot
- Documentar m√©todos p√∫blicos
- Escrever testes unit√°rios
- Manter cobertura de c√≥digo acima de 80%

### Trabalhando com o Banco H2

**Acesso ao Console:**

1. Inicie a aplica√ß√£o
2. Acesse `http://localhost:4567/h2-console`
3. Use as credenciais: JDBC URL: `jdbc:h2:mem:testdb`, User: `sa`, Password: (vazio)

**Queries √∫teis:**

```sql
-- Ver todas as tarefas
SELECT * FROM crawl_tasks;

-- Ver URLs encontradas para uma tarefa espec√≠fica
SELECT * FROM crawl_urls WHERE task_id = 'your-task-id';

-- Ver estat√≠sticas de uma tarefa
SELECT 
    ct.id,
    ct.keyword,
    ct.status,
    COUNT(cu.id) as total_urls_found,
    COUNT(DISTINCT vu.url) as pages_processed
FROM crawl_tasks ct
LEFT JOIN crawl_urls cu ON ct.id = cu.task_id
LEFT JOIN visited_urls vu ON ct.id = vu.task_id
WHERE ct.id = 'your-task-id'
GROUP BY ct.id;
```

## Documenta√ß√£o Adicional

Documenta√ß√µes t√©cnicas detalhadas est√£o dispon√≠veis na pasta `docs/`:

- **[docs/DESAFIO_JAVA_AXUR.md](docs/DESAFIO_JAVA_AXUR.md)**: Requisitos originais do desafio
- **[docs/DATABASE.md](docs/DATABASE.md)**: Estrutura do banco de dados e massa de dados
- **[docs/SWAGGER-API.md](docs/SWAGGER-API.md)**: Documenta√ß√£o da API com OpenAPI/Swagger
- **[docs/DOCKER-COMPOSE.md](docs/DOCKER-COMPOSE.md)**: Guia de uso do Docker Compose
- **[docs/UTF8-CONFIG.md](docs/UTF8-CONFIG.md)**: Configura√ß√µes UTF-8 implementadas

## Sobre o Desenvolvedor

**Nome:** Christian Vladimir Uhdre Mulato  
**Posi√ß√£o:** Candidato a Desenvolvedor Java S√™nior  
**Empresa:** Axur  
**Data:** Janeiro 2025  

### Tecnologias Demonstradas

- **Java 17** com features modernas
- **Spring Boot 3.4.1** com configura√ß√£o avan√ßada
- **Arquitetura de microservi√ßos** com mensageria
- **Testes unit√°rios** com alta cobertura
- **Containeriza√ß√£o** Docker + Docker Compose
- **Banco de dados** H2 + Flyway migrations
- **Documenta√ß√£o** t√©cnica completa

### Decis√µes Arquiteturais

1. **RabbitMQ** para processamento ass√≠ncrono (escalabilidade)
2. **H2 + Flyway** para persist√™ncia e migra√ß√µes (praticidade)
3. **Spring Actuator** para monitoramento (observabilidade)
4. **JaCoCo** para cobertura de testes (qualidade)
5. **UTF-8** completo para internacionaliza√ß√£o (boas pr√°ticas)
6. **Docker Compose** para facilitar execu√ß√£o (DX)

---

**Nota:** Este projeto foi desenvolvido como solu√ß√£o para o teste t√©cnico da Axur, demonstrando conhecimentos em desenvolvimento Java enterprise, arquitetura de software e boas pr√°ticas de desenvolvimento.

## Testes Automatizados

### Cobertura Completa de Todos os Requisitos

Este projeto possui **cobertura de testes automatizados para 100% dos requisitos** do desafio t√©cnico. Foram criados testes espec√≠ficos para cada um dos 8 requisitos obrigat√≥rios, al√©m de testes adicionais para comportamentos espec√≠ficos e integra√ß√£o E2E.

### Testes por Requisito

```markdown
|------------------------------|---------------------------------|-----------------------------------------------------------|
| Requisito                    | Arquivo de Teste                | Cen√°rios Cobertos                                         |
|------------------------------|---------------------------------|-----------------------------------------------------------|
| **1. API HTTP**              | `ApiHttpTest.java`              | POST /crawl, GET /crawl/{id}, formatos JSON, c√≥digos HTTP |
| **2. Valida√ß√£o do termo**    | `TermValidationTest.java`       | 4-32 caracteres, case insensitive, rejei√ß√£o de inv√°lidos  |
| **3. ID da busca**           | `CrawlIdGenerationTest.java`    | 8 caracteres alfanum√©ricos, gera√ß√£o autom√°tica, unicidade |
| **4. URL base**              | `BaseUrlConfigurationTest.java` | Vari√°vel de ambiente, formato v√°lido, resolu√ß√£o de links  |
| **5. M√∫ltiplas buscas**      | `MultipleCrawlsTest.java`       | Execu√ß√£o paralela, estado independente, persist√™ncia      |
| **6. Resultados parciais**   | `PartialResultsTest.java`       | Disponibilidade durante processamento, incremento de URLs |
| **7. Estrutura do projeto**  | `ProjectStructureTest.java`     | Dockerfile, pom.xml, estrutura de diret√≥rios              |
| **8. Compila√ß√£o e execu√ß√£o** | `CompilationExecutionTest.java` | Porta 4567, comandos Docker, vari√°veis de ambiente        |
|------------------------------|---------------------------------|-----------------------------------------------------------|
```

### Testes Adicionais

- **`CrawlerBehaviorTest.java`**: Comportamentos espec√≠ficos (case sensitivity, charset, edge cases)
- **`EndToEndIntegrationTest.java`**: Testes E2E com massa de dados realista do `sample-data.sql`
- **`AllRequirementsTestSuite.java`**: Documenta√ß√£o e organiza√ß√£o da su√≠te completa

### Comandos de Execu√ß√£o

#### Executar todos os testes

```bash
mvn test
```

#### Executar por requisito espec√≠fico

```bash
# Requisito 1 - API HTTP
mvn test -Dtest="ApiHttpTest"

# Requisito 2 - Valida√ß√£o do termo
mvn test -Dtest="TermValidationTest"

# Requisito 3 - ID da busca
mvn test -Dtest="CrawlIdGenerationTest"

# Requisito 4 - URL base
mvn test -Dtest="BaseUrlConfigurationTest"

# Requisito 5 - M√∫ltiplas buscas simult√¢neas
mvn test -Dtest="MultipleCrawlsTest"

# Requisito 6 - Resultados parciais
mvn test -Dtest="PartialResultsTest"

# Requisito 7 - Estrutura do projeto
mvn test -Dtest="ProjectStructureTest"

# Requisito 8 - Compila√ß√£o e execu√ß√£o
mvn test -Dtest="CompilationExecutionTest"
```

#### Executar testes adicionais

```bash
# Comportamentos espec√≠ficos
mvn test -Dtest="CrawlerBehaviorTest"

# Integra√ß√£o E2E
mvn test -Dtest="EndToEndIntegrationTest"
```

#### Executar via Docker

```bash
docker build . -t axreng/backend
docker run --rm axreng/backend mvn test

# Com vari√°vel de ambiente espec√≠fica
docker run -e BASE_URL=http://hiring.axreng.com/ --rm axreng/backend mvn test
```

### Relat√≥rio de Cobertura

```bash
# Executar testes com cobertura
mvn clean test jacoco:report

# Verificar cobertura m√≠nima (80%)
mvn clean test jacoco:check
```

O relat√≥rio de cobertura JaCoCo ser√° gerado em `target/site/jacoco/index.html`

### Documenta√ß√£o Detalhada dos Testes

Para documenta√ß√£o completa de todos os testes implementados, consulte:

- **[Cobertura Completa de Testes](docs/TESTES-COBERTURA-COMPLETA.md)**: Detalhamento de todos os testes por requisito

### Estat√≠sticas de Testes

- **Total de arquivos de teste**: 10
- **Total de m√©todos de teste**: 50+
- **Requisitos cobertos**: 8/8 (100%)
- **Cen√°rios**: Positivos, negativos, edge cases, concorr√™ncia, performance
- **Tipos**: Unit√°rios, integra√ß√£o, E2E
- **Massa de dados**: sample-data.sql com dados realistas

---
